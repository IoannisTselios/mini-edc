<div id="ae-section">
  <h3>Adverse Events</h3>

  <form
    method="post"
    action="{% url 'core:ae_create' study.code subject.subject_id %}"
    hx-post="{% url 'core:ae_create' study.code subject.subject_id %}"
    hx-target="#ae-section"
    hx-swap="outerHTML"
  >
    {% csrf_token %}
    {{ ae_form.as_p }}  
    <button type="submit">Record adverse event</button>
  </form>

  {% if aevents %}
    <table>
      <tr><th>Onset</th><th>Severity</th><th>Description</th><th>Related</th></tr>
      {% for ae in aevents %}
        <tr>
          <td>{{ ae.onset|date:"Y-m-d H:i" }}</td>
          <td>{{ ae.severity|title }}</td>
          <td>{{ ae.description }}</td>
          <td>{{ ae.related_to_study }}</td>
        </tr>
      {% endfor %}
    </table>
  {% else %}
    <p>No adverse events recorded for this subject yet.</p>
  {% endif %}
</div>
